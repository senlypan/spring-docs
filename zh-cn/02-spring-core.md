# Spring核心

> 作者: 潘深练
>
> 更新: 2022-03-14


## 关于框架

对于程序员来说，我们通常知道很多概念，例如组件、模块、系统、框架、架构等。

- **组件**

- **模块**

- **框架**，本质上是一些实用经验集合。即是前辈们在实际开发过程中积攒下来的实战经验，累积成一套实用工具，避免你在开发过程中重复去造轮子，特别是帮你把日常中能遇到的场景或问题都给屏蔽掉，框架的意义在于屏蔽掉开发的基础复杂度、屏蔽掉此类共性的东西，让框架使用者只关注于差异面，即业务层面的实现。简而言之，框架只干一件事，那就是 **简化开发**。然后在此基础上，可能会再考虑一些安全性、效率、性能、弹性、管理、拓展、解耦等等。

- **系统**

- **架构**，是我们关注的系统层面的一个顶层结构。

## Spring核心

Spring 作为一个框架，目的也是：**简化开发** ，只不过在简化开发的过程中 Spring 做了一个特别的设计，那就是 `Bean管理`，这也是 Spring 的设计核心，而 Bean 生命周期管理的设计巧妙的 `解耦了 Bean 之间的关系`。

因此 Spring 核心特性就是 **解耦** 和 **简化**。

![02-spring-001](../_media/image/02-spring/02-spring-001.png)

Spring 框架图示展示得很清晰，基本描绘出 Spring 框架的核心：

- **内核**
- **外延**

简单说，就是 Spring 设计了一个核心容器 `Core Container`，这里头主要就是管理 Bean 生命周期，然后为了服务这些业务 Bean ，引入了 `Core` , `Context` , `SpEL` 等工具到核心容器中。然后在核心容器基础上，又为了把更多的能力集成进来，例如为了拓展 **数据访问** 能力加入了 `JDBC` 、`ORM` 、`OXM` 、`JMS` 、`Transactions`等，为了拓展 **Web** 能力加入了 `WebSocket` 、`Servlet`、`Web`、`Portlet`等，其中为了把 `RequestMapping` 或 `Servlet` 等这些使用集成到业务 Bean 上，引入了 `AOP` ，包括还有引入（最终是提供） `Aspects`、`Instrumentation`、`Messageing`等增强方式。

所以仔细一看，Spring 就是把像数据库访问、Web支持、缓存、消息发送等等这些能力集成到业务 Bean 上，并提供一些测试支持。总结来说理解 Spring 就两点：

1. **Bean管理：** 解耦Bean关系。理解为内核，从 Bean 的定义、创建、管理等，这是业务Bean。

2. **功能增强：** 解耦功能、声明式简化。理解为外延，在业务Bean基础上，需要访库等能力，那就是功能增强。


基本体现的就是两个核心特性，一个 **解耦**、一个 **简化**。


Bean管理本身就是在做解耦，解除耦合，这个解耦指 Bean 和 Bean 之间的关联关系，Bean 之间通过接口协议串联起来的，至于每个接口有多少个实现类、或是方法增减了、引用变更了，那都不会有任何影响，也不会相互污染，Bean 之间只保留单点通道，相互隔离，关系都交给了 Spring 管理。

功能增强本身就是在做简化，例如声明式简化，框架使用者只需要告诉框架你要什么，不需要了解如何实现。另外简化方面还有 **约定优于配置** （当然这个确切的说我们认为是 `SpringBoot` 里的设计），约定优于配置其实就是约定好了无需去做复杂的配置，例如你引入一个什么组件或能力就像 `redis` 或 `kafka` ，你不需要提前配置，因为 `springboot` 已经为你默认配置。

> 最后再总结 Spring 框架特性，就是 **解耦** 和 **简化** ，没有其它了。

对于 SpringBoot，简单理解就是在 Spring 框架基础上添加了一个 `SPI 可拓展机制` 和 `版本管理`，让易用性更高，简化升级。

对于 SpringCloud，简单理解就是，由于 SpringBoot 的 **依赖** 可以被很好的管理，**拓展** 可以被可插拔的拓展，因此在 SpringBoot 基础上集成了很多跟微服务架构相关的能力，例如集成了很多组件。

所以我们说回 Spring 的核心设计。

## IOC 
- 控制反转（百度百科）<beans管理>
	- setter注入
	- 构造注入

## 反射 （在永久代放了一堆字节码，然后给拿出来实例化）

## AOP
- AOP <做增强>（声明式编程+注解）--> 简化与解耦 
	- 性能监控
	- 缓存代理
	- 软件破解
	- 记录日志
	- 工作流系统
	- 权限验证 
- AOP 实现 （java给你开的口就这三个）
	- 编译期 lombok，mapstruct（编译期通过pluggable annotation processing 修改的）
	- 字节码加载前 javasist ,  java.lang.instrument<ClassFileTransformer> （很多agent都这么搞）
	- 字节码加载后 jdk proxy, cglib+ASM（操纵）
- AOP 类别 （约早织入，性能越好，但是灵活性等方面当然也会差些，权衡比较）
	- 静态AOP（编译期）
	- 动态AOP
	- 动态字节码生成
	- 自定义类加载器
	- 字节码转换 

- spring aop
	- 因为用了cglib，没法切final（因为没法生成子类）
	- 没法切static ,private，类内方法ab方法互调也没法切等

（修改class，安全点也会通知所有线程停下来，因为要改类结构了呢）
？？？思考 ：spring为什么要采用cglib
### spring 就等于 反射（为了AOP和***） +字节码增强（为了简化和声明式编程）

### bean --> 从无到有，到增强

### 三级缓存，说白了对应bean的生命周期三种形态
- 定义
- 实例
- 增强




（本篇完）

?> ❤️ 您也可以参与梳理，快来提交 [issue](https://github.com/senlypan/spring-docs/issues) 或投稿参与吧~